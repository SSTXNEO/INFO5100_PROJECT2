<!DOCTYPE html>
<html>

<head>
	<style>

		* {
			box-sizing: border-box;
		}

		html,
		body {
			margin: 0;
			padding: 0;
		}

		body {
			min-height: 1280px;
			font-weight: 300;
			color: #2a2a2a;
		}

		p,
		h1,
		h2,
		h3,
		h4,
		a {
			margin: 0;
			font-weight: 300;
		}

		a,
		a:visited,
		a:hover {
			color: #f30;
			text-decoration: none;
		}

		/* scrollama */

		#scroll {
			position: relative;
		}

		.scroll__graphic {
			position: absolute;
			top: 0;
			left: 0;
			bottom: auto;
			background-color: #fff;
			-webkit-transform: translate3d(0, 0, 0);
			-moz-transform: translate3d(0, 0, 0);
			transform: translate3d(0, 0, 0);
		}

		.scroll__graphic.is-fixed {
			position: fixed;
		}

		.scroll__graphic.is-bottom {
			bottom: 0;
			top: auto;
		}

		.chart {
			position: absolute;
			right: 0rem;
			top: 50%;
			-moz-transform: translateY(-50%);
			-webkit-transform: translateY(-50%);
			transform: translateY(-50%);
			background-color: #000;
		}

		.chart p {
			text-align: center;
			position: absolute;
			top: 50%;
			left: 50%;
			-moz-transform: translate(-50%, -50%);
			-webkit-transform: translate(-50%, -50%);
			transform: translate(-50%, -50%);
			font-size: 8rem;
			font-weight: 900;
			color: #666;
		}

		.scroll__text {
			position: relative;
			max-width: 30rem;
			width: 33%;
		}

		.step {
			background-color: black;
		}

		.step.is-active {
			background-color: black;
		}

		.step p {
			padding-top: 150px;
			padding-left: 50px;
			text-align: center;
			font-size: 1.5rem;
			font-family: Courier;
			color: #fff;
		}

		.orbit {
	       stroke : #000000;
	       fill : none;
      	}

	    .planet {
	       -webkit-animation: fadein 2s;
	       fill : #FFFFFF;
     	}

		@-webkit-keyframes fadein {
    	from { opacity: 0; }
    	to   { opacity: 0.7; }
		}

        .sun {
	        fill : #fff;
	        opacity: 0.7;
	    }

	</style>

</head>

<body>
	<section id='scroll'>
		<div class='scroll__graphic'>
			<div class='chart'>
				<p></p>
			</div>
		</div>
		<div class='scroll__text'>
			<div class='step' data-step='1' id='step1'>
				<p style="font-weight:bold; font-size:24pt;">"The population is becoming more <span style="color:#1db954">diverse</span> over time and the question is: What is <span style="color:#1db954">Hollywood</span> doing relative to that population increasing in diversity<span style="color:#1db954">?</span>"</p> </br>
				<p> Scroll to explore</p>
			</div>
			<div class='step' data-step='2' id='step2'>
				<p>We explored all time domestic box office results and selected <span style="color:#1db954">500 highest-grossing</span> movies, with the <span style="color:#1db954">oldest</span> ones being <span style="color:#1db954">closest to the center</span> and the <span style="color:#1db954">most current</span> ones <span style="color:#1db954">outside the outermost orbit</span>. We chose the <span style="color:#1db954">first actor/actress listed on IMDb</span> for the movie as the <span style="color:#1db954">leading</span> one.</p>
			</div>
			<div class='step' data-step='3' id='step3'>
				<p>From <span style="color:#1db954">1937</span> to <span style="color:#1db954">1949</span>, <span style="color:#1db954">None</span> of the movies contain<span style="color:#1db954"> female</span> lead actress. <span style="color:#92bcea">1/3</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='4' id='step4'>
				<p>From <span style="color:#1db954">1950</span> to <span style="color:#1db954">1959</span>, <span style="color:#1db954">none</span> of the movies contains female lead or minority lead actor/actress. </p>
			</div>
			<div class='step' data-step='5' id='step5'>
				<p>From <span style="color:#1db954">1960</span> to <span style="color:#1db954">1969</span>, <span style="color:#1db954">1/2</span> of the movies contain<span style="color:#1db954"> female</span> lead actress. <span style="color:#92bcea">None</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='6' id='step6'>
				<p>From <span style="color:#1db954">1970</span> to <span style="color:#1db954">1979</span>, <span style="color:#1db954">1/9</span> of the movies contain<span style="color:#1db954"> female</span> lead actress. <span style="color:#92bcea">None</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='7' id='step7'>
				<p>From <span style="color:#1db954">1980</span> to <span style="color:#1db954">1989</span>, <span style="color:#1db954">1/25</span> of the movies contain<span style="color:#1db954"> female</span> lead actress. <span style="color:#92bcea">3/25</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='8' id='step8'>
				<p>From <span style="color:#1db954">1990</span> to <span style="color:#1db954">1999</span>, <span style="color:#1db954">6/68</span> of the movies contain<span style="color:#1db954"> female</span> lead actress. <span style="color:#92bcea">3/68</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='9' id='step9'>
				<p>From <span style="color:#1db954">1990</span> to <span style="color:#1db954">1999</span>, <span style="color:#1db954">19/170</span> of the movies contain<span style="color:#1db954"> female</span> lead actress. <span style="color:#92bcea">14/170</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='10' id='step10'>
				<p>From <span style="color:#1db954">2009</span> to <span style="color:#1db954">2018</span>, <span style="color:#1db954">39/223</span> of the movies contain<span style="color:#1db954"> female</span> lead actress. <span style="color:#92bcea">20/223</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='11' id='step11'>
				<p>Despite the emergence of film and television series heralded for their diversity, Darnell Hunt, sociologist and co-author of UCLA's 2018 Hollywood Diversity Report, maintains little has changed both in front of and behind the camera.</p>
			</div>
			<div class='step' data-step='12' id='step12'>
				<p>However, we do notice some trends from our data...</p>
			</div>
 		</div>
	</section>

	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src='https://unpkg.com/intersection-observer'></script>
	<script src='https://unpkg.com/scrollama'></script>
	<script src="https://d3js.org/d3-selection-multi.v0.4.min.js"></script>
	<script>
		var width = 1200, height = 900;
		    var t0 = Date.now();
		    var svg = d3.select(".chart")
		    .insert("svg")
		    .attr("width", width)
		    .attr("height", height)
		    .attr("id", "canvas");
		// using d3 for convenience
		var container = d3.select('#scroll');
		var graphic = container.select('.scroll__graphic');
		var chart = graphic.select('.chart');
		var text = container.select('.scroll__text');
		var step = text.selectAll('.step');
		var formatYear=d3.timeFormat("%Y");
		var appended1 = false;
		var appended2 = false;
		var appended3 = false;
		var appended4 = false;
		var appended5 = false;
		var appended6 = false;
		var appended7 = false;

		// initialize the scrollama
		var scroller = scrollama();

		// generic window resize listener event
		function handleResize() {
			// 1. update height of step elements
			var stepHeight = Math.floor(window.innerHeight);
			step.style('height', stepHeight + 'px');

			// 2. update width/height of graphic element
			var bodyWidth = d3.select('body').node().offsetWidth;

			graphic
				.style('width', bodyWidth + 'px')
				.style('height', window.innerHeight + 'px');

			var textWidth = text.node().offsetWidth;
			var chartWidth = graphic.node().offsetWidth - textWidth;

			chart
			.style('width', chartWidth + 'px')
			.style('height', Math.floor(window.innerHeight) + 'px');


			// 3. tell scrollama to update new element dimensions
			scroller.resize();
		}

		// scrollama event handlers
		function handleStepEnter(response) {
			// response = { element, direction, index }

			// add color to current step only
			step.classed('is-active', function (d, i) {
				return i === response.index;
			});

			if (response.direction == "down" && response.index == 2 && appended1 == false){

				var c = 0;
				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) > 1937 && (+formatYear(d.time)) <= 1949){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

				           	if (d.if_female === 1){

					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "c"+c)
					            .attr("class", "planet minority")
					            .style("fill", "#1db954");

					            d3.select("#step3").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#c" + c)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#c" + c)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {
				           	    c = c + 1;
				           	    var dd=c;
					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "d"+dd)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea");

					            d3.select("#step3").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#d" + dd)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#d" + dd)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });
					        }

			        	}

			        }

				});

				appended1 = true;

			}

			else if (response.direction == "down" && response.index == 4 && appended2 == false){

				var e = 0;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) > 1959 && (+formatYear(d.time)) <= 1969){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

			            	e = e + 1;

				           	if (d.if_female === 1){

					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "e"+e)
					            .attr("class", "planet minority")
					            .style("fill", "#1db954");

					            d3.select("#step5").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#e" + e)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	console.log("here2");
							    	console.log(e);
							    	d3.select("#e" + e)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {

					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("id", "e"+e)
					            .attr("cy", 0)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea");

					            d3.select("#step5").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#e" + e)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#e" + e)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });
					        }

			        	}

					}

				});

				appended2 = true;
			}

			else if (response.direction == "down" && response.index == 5 && appended3 == false){

				var f = 0;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) > 1969 && (+formatYear(d.time)) <= 1979){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

			            	f = f + 1;

				           	if (d.if_female === 1){

					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "f"+f)
					            .attr("class", "planet minority")
					            .style("fill", "#1db954");

					            d3.select("#step6").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#f" + f)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#f" + f)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {

					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "f"+f)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea");

					            d3.select("#step6").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#f" + f)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#f" + f)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });
					        }

			        	}

			    	}

				});

				appended3 = true;
			}

			else if (response.direction == "down" && response.index == 6 && appended4 == false){

			    var g = 0;
				var h = 0;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) > 1979 && (+formatYear(d.time)) <= 1989){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

				           	if (d.if_female === 1){

				           		g = g + 1;
				           		console.log(g);
					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "g"+g)
					            .attr("class", "planet minority")
					            .style("fill", "#1db954");

					            d3.select("#step7").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#g" + g)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#g" + g)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {
								h=h+1;
//								console.log(h);
								var o=h;
					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("id", "h"+h)
					            .attr("cy", 0)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea");


					            d3.select("#step7").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
//					                console.log(z);
							    	d3.select("#h" + o)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#h" + o)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });
					        }

			        	}

			    	}

				});

				appended4 = true;

			}

			else if (response.direction == "down" && response.index == 7 && appended5 == false){

			    var j = 0;
				var k = 0;
				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) >= 1989 && (+formatYear(d.time)) < 1999){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

				           	if (d.if_female === 1){

				           		j = j + 1;
				           		var p=j;
//				           		console.log(i);
					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "i"+p)
					            .attr("class", "planet minority")
					            .style("fill", "#1db954");

					            d3.select("#step8").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#i" + p)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#i" + p)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {

					        	k = k + 1;
								var q=k;
					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("id", "j"+q)
					            .attr("cy", 0)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea");

//					            console.log(j);

					            d3.select("#step8").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#j" + q)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#j" + q)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });
					        }
					    }
			    	}

				});

				appended5 = true;

			}

			else if (response.index == 8){
			    var l=0;
				var m=0;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) >= 1999 && (+formatYear(d.time)) < 2009){
			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

				           	if (d.if_female === 1){
								l=l+1;
								var r=l;
					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
								.attr("id","l"+r)
					            .attr("class", "planet minority")
					            .style("fill", "#1db954");

					           	d3.select("#step9").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#l" + r)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#l" + r)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {

				           	    m=m+1;
				           	    var s=m;
					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
								.attr("id","m"+s)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea");

					        	d3.select("#step9").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#m" + s)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#m" + s)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        }

			        	}

			        	if (appended6 == false){

				        	d3.select("#step9").append("text")
					            .text(d.title + "  ")
					            .style("color", "grey")
					            .style("font-size", "5pt")
					            .style("font-family", "Courier");

					    }
					}
				});

				appended6 = true;
			}

			else if (response.index == 9){

			    var n=0;
				var oo=0;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) >= 2009 && (+formatYear(d.time)) < 2019){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

				           	if (d.if_female === 1){
								n=n+1;
								var t=n;
					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
								.attr("id","n"+t)
					            .attr("class", "planet minority")
					            .style("fill", "#1db954");

					           	d3.select("#step10").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#n" + t)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#n" + t)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {
								oo=oo+1;
								var u=oo;
					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
								.attr("id","oo"+u)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea");

					        	d3.select("#step10").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#oo" + u)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 10);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#oo" + u)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        }
			        	}

			    		if (appended7 == false){

				        	d3.select("#step10").append("text")
					            .text(d.title + "  ")
					            .style("color", "grey")
					            .style("font-size", "4pt")
					            .style("font-family", "Courier");

						}
					}

				});

				appended7 = true;
			}

			if (response.index == 11){
			    d3.selectAll("g.planet")
					.each(function(d) {
						d.speed = 0;
                        });
				d3.selectAll("g.planet").selectAll("circle")
					.filter(function(d){return d.title!=="I Am Legend"})
					.transition()
					.duration(500)
					.style("opacity",0.1);
				d3.selectAll("g.planet").selectAll("circle")
					.filter(function(d){return d.title==="I Am Legend"})
					.transition()
					.duration(500)
					.attr("r",10);


				var zoom, zoomable_layer;
				  var amp=1.5;
				  zoomable_layer = svg;

				  zoom = d3.zoom().scaleExtent([1, 10]).on('zoom', function() {
					return zoomable_layer.attrs({
					  transform: d3.event.transform
					});
				  });
				  svg.call(zoom);

					to_bounding_box = function(W, H, center) {
					var x, y;
					x = W / 2 - center.x*amp;
					y = H / 2 - center.y*amp;
					return d3.zoomIdentity.translate(x,y).scale(amp);
				  };
					var center, transform;
					center = {
					  x: d3.select("#m1").node().getBoundingClientRect().x,
					  y: d3.select("#m1").node().getBoundingClientRect().y
					};
					transform = to_bounding_box(width, height, center);
					svg.transition().duration(2000).call(zoom.transform, transform);

//				  console.log(d3.select("#h1").node().getBoundingClientRect());
			}


		}

		function handleContainerEnter(response) {
			// response = { direction }

			// sticky the graphic (old school)
			graphic.classed('is-fixed', true);
			graphic.classed('is-bottom', false);
		}

		function handleContainerExit(response) {
			// response = { direction }

			// un-sticky the graphic, and pin to top/bottom of container
			graphic.classed('is-fixed', false);
			graphic.classed('is-bottom', response.direction === 'down');
		}

		function init() {
			// 1. force a resize on load to ensure proper dimensions are sent to scrollama
			handleResize();

			// 2. setup the scroller passing options
			// this will also initialize trigger observations
			// 3. bind scrollama event handlers (this can be chained like below)
			scroller.setup({
				container: '#scroll',
				graphic: '.scroll__graphic',
				text: '.scroll__text',
				step: '.scroll__text .step',
			})
				.onStepEnter(handleStepEnter)
				.onContainerEnter(handleContainerEnter)
				.onContainerExit(handleContainerExit);

			// setup resize event
			window.addEventListener('resize', handleResize);



		    svg.append("circle")
		    .attr("r", 10)
		    .attr("cx", width/2)
		    .attr("cy", height/2)
		    .attr("class", "sun");

		    var container = svg.append("g")
		    .attr("class","spinner")
		    .attr("transform", "translate(" + width/2 + "," + height/2 + ")");

		    var parseTime = d3.timeParse("%d-%b-%Y");

 			var inter1=d3.scaleTime().domain([parseTime("01-Jan-1937"),parseTime("31-Dec-1949")]).range([50, 80]);
      		var inter2=d3.scaleTime().domain([parseTime("01-Jan-1950"),parseTime("31-Dec-1959")]).range([100, 130]);
      		var inter3=d3.scaleTime().domain([parseTime("01-Jan-1960"),parseTime("31-Dec-1969")]).range([150, 180]);
      		var inter4=d3.scaleTime().domain([parseTime("01-Jan-1970"),parseTime("31-Dec-1979")]).range([200, 230]);
    		var inter5=d3.scaleTime().domain([parseTime("01-Jan-1980"),parseTime("31-Dec-1989")]).range([250, 280]);
      		var inter6=d3.scaleTime().domain([parseTime("01-Jan-1990"),parseTime("31-Dec-1999")]).range([300, 330]);
      		var inter7=d3.scaleTime().domain([parseTime("01-Jan-2000"),parseTime("31-Dec-2009")]).range([350, 380]);
      		var inter8=d3.scaleTime().domain([parseTime("01-Jan-2010"),parseTime("01-May-2018")]).range([400, 430]);

		    var speedScale=d3.scaleLinear().domain([120908074,1000000000]).range([5,1]);

		    var divisionOrbitData=[90,140,190,240,290,340,390];
      		svg.selectAll(".division")
            .data(divisionOrbitData)
          	.enter()
          	.append("circle")
          	.attr("class","division")
         	.each(function(d){
             	d3.select(this)
                .attr("cx", width/2)
                .attr("cy", height/2)
                .attr("r", d)
                .style("fill","none")
                .style("stroke","#fff");
          	});

		    function parseline(line){

		        var year=+formatYear(parseTime(line.year));

		        if(year<=1949){
		            var radiusOrbit=inter1(parseTime(line.year));
		        }
		        else if(year<=1959){
		            radiusOrbit=inter2(parseTime(line.year));
		        }
		        else if(year<=1969){
		            radiusOrbit=inter3(parseTime(line.year));
		        }
		        else if(year<=1979){
		            radiusOrbit=inter4(parseTime(line.year));
		        }
		        else if(year<=1989){
		            radiusOrbit=inter5(parseTime(line.year));
		        }
		        else if(year<=1999){
		            radiusOrbit=inter6(parseTime(line.year));
		        }
		        else if(year<=2009){
		            radiusOrbit=inter7(parseTime(line.year));
		        }
		        else if(year<=2018){
		            radiusOrbit=inter8(parseTime(line.year));
		        }
		        return {
		        	title:line.title,
		            time:parseTime(line.year),
		            box_office:+line.box_office,
		            if_female:+line.female_lead,
		            if_black:+line.non_white_lead,
		            radiusOrbit:radiusOrbit,
		            radiusDot:5,
		            speed:speedScale(line.box_office),
		            phi0: Math.floor(360*Math.random())
        		}
		    }

		    d3.csv("./movie_actor.csv",parseline,function(data) {

		        var planets = [];
		        data.forEach(function (d) {
		            planets.push({
		            	title:d.title,
		            	time: d.time,
		                R: d.radiusOrbit,
		                r: d.radiusDot,
		                speed: d.speed,
		                temp: d.speed,
		                phi0: d.phi0,
		                if_female: d.if_female,
		                if_black: d.if_black
		            });
		        });

		        container.selectAll("g.planet")
		        .data(planets)
		        .enter()
		        .append("g")
		        .attr("class", "planet")
		        .each(function (d, i) {

		            d3.select(this)
		            .append("circle")
		            .attr("class", "orbit")
		            .attr("r", d.R)
		            .style("stroke", "none");

		        });

		        var j = 0;

		        d3.select("svg#canvas")
		        .on("click", function(){
		        	if (j % 2 === 0){
		        		j = j + 1;
		        		container.selectAll("g.planet")
		        		.data(planets)
		        		.each(function(d){
		        			d.speed = 0;
		        		});
		        	}else {
		        		j = j + 1;
		        		container.selectAll("g.planet")
		        		.data(planets)
		        		.each(function(d){
		        			d.speed = d.temp;
		        		});
		        	}
		        });

		        d3.select("#canvas")
			    .append("circle")
				.attr("r", 5)
				.attr("cx", 800)
				.attr("cy", 50)
				.style("fill", "#1db954");

				d3.select("#canvas")
				.append("text")
				.text("female lead")
				.attr("x", 810)
				.attr("y", 55)
				.style("font-family", "Courier")
				.style("fill", "white");

				d3.select("#canvas")
			    .append("circle")
				.attr("r", 5)
				.attr("cx", 800)
				.attr("cy", 70)
				.style("fill", "#92bcea");

				d3.select("#canvas")
				.append("text")
				.text("minority lead")
				.attr("x", 811)
				.attr("y", 75)
				.style("font-family", "Courier")
				.style("fill", "white");

				d3.select("#canvas")
			    .append("circle")
				.attr("r", 5)
				.attr("cx", 800)
				.attr("cy", 90)
				.style("fill", "white");

				d3.select("#canvas")
				.append("text")
				.text("male/Caucasian")
				.attr("x", 810)
				.attr("y", 95)
				.style("font-family", "Courier")
				.style("fill", "white");

				d3.select("#canvas")
				.append("text")
				.text("lead")
				.attr("x", 810)
				.attr("y", 115)
				.style("font-family", "Courier")
				.style("fill", "white");

		        d3.timer(function () {

		            var delta = (Date.now() - t0);

		            svg.selectAll(".planet")
		            .attr("transform", function (d) {
		                return "rotate(" + d.phi0 + delta * d.speed / 500 + ")";
		            });

		        });

		    });

		}

		// kick things off
		init();

	</script>
</body>

</html>
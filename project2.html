<!DOCTYPE html>
<html>

<head>
	<style>

		* {
			box-sizing: border-box;
		}

		html,
		body {
			margin: 0;
			padding: 0;
		}

		body {
			min-height: 1280px;
			font-weight: 300;
			color: #2a2a2a;
		}

		p,
		h1,
		h2,
		h3,
		h4,
		a {
			margin: 0;
			font-weight: 300;
		}

		a,
		a:visited,
		a:hover {
			color: #f30;
			text-decoration: none;
		}

		/* scrollama */

		#scroll {
			position: relative;
		}

		.scroll__graphic {
			position: absolute;
			top: 0;
			left: 0;
			bottom: auto;
			background-color: #fff;
			-webkit-transform: translate3d(0, 0, 0);
			-moz-transform: translate3d(0, 0, 0);
			transform: translate3d(0, 0, 0);
		}

		.scroll__graphic.is-fixed {
			position: fixed;
		}

		.scroll__graphic.is-bottom {
			bottom: 0;
			top: auto;
		}

		.chart {
			position: absolute;
			right: 0rem;
			top: 50%;
			-moz-transform: translateY(-50%);
			-webkit-transform: translateY(-50%);
			transform: translateY(-50%);
			background-color: #000;
		}

		.chart p {
			text-align: center;
			position: absolute;
			top: 50%;
			left: 50%;
			-moz-transform: translate(-50%, -50%);
			-webkit-transform: translate(-50%, -50%);
			transform: translate(-50%, -50%);
			font-size: 8rem;
			font-weight: 900;
			color: #666;
		}

		.scroll__text {
			position: relative;
			max-width: 30rem;
			width: 33%;
		}

		.step {
			background-color: black;
		}

		.step.is-active {
			background-color: black;
		}

		.step p {
			padding-top: 150px;
			padding-left: 50px;
			text-align: left;
			font-size: 1.5rem;
			font-family: Courier;
			color: #fff;
		}

		.step div {
			text-align: center;
			margin-top: 10px;
		}

		.step span {
			margin: auto 0;
		}

		.orbit {
	       stroke : #000000;
	       fill : none;
      	}

	    .planet {
	       -webkit-animation: fadein 2s;
	       fill : #FFFFFF;
     	}

		@-webkit-keyframes fadein {
    	from { opacity: 0; }
    	to   { opacity: 0.5; }
		}

        .sun {
	        fill : #fff;
	        opacity: 0.5;
	    }

	</style>

</head>

<body>
	<section id='scroll'>
		<div class='scroll__graphic'>
			<div class='chart' id="planetarium">
				<p></p>
			</div>
		</div>
		<div class='scroll__text'>
			<div class='step' data-step='1' id='step1'>
				<p style="font-weight:bold; font-size:24pt;">"The population is becoming more <span style="color:#f77062">diverse</span> over time and the question is: What is <span style="color:#f77062">Hollywood</span> doing relative to that population increasing in diversity<span style="color:#f77062">?</span>"</p> </br>
				<p> Scroll to explore</p>
			</div>
			<div class='step' data-step='2' id='step2'>
				<p>We explored all time domestic box office results and selected <span style="color:#f77062">500 highest-grossing</span> movies, with the <span style="color:#f77062">oldest</span> ones being <span style="color:#f77062">closest to the center</span> and the <span style="color:#f77062">most current</span> ones <span style="color:#f77062">outside the outermost orbit</span>. We chose the <span style="color:#f77062">first actor/actress listed on IMDb</span> for the movie as the <span style="color:#f77062">leading</span> one.</p>
				<p><span style="color:#f77062">Faster-moving</span> dots indicate <span style="color:#f77062">lower</span> box office and vice versa. </p>
			</div>
			<div class='step' data-step='3' id='step3'>
				<p>From <span style="color:#f77062">1937</span> to <span style="color:#f77062">1949</span>, <span style="color:#f77062">no</span><span style="color:#92bcea">ne</span> of the movies contains <span style="color:#f77062">female</span> lead or <span style="color:#92bcea">minority</span> lead actor/actress. </p>
				<p>Click on the graph to start/stop spinning. </p>
			</div>
			<div class='step' data-step='4' id='step4'>
				<p>From <span style="color:#f77062">1950</span> to <span style="color:#f77062">1959</span>, <span style="color:#f77062">no</span><span style="color:#92bcea">ne</span> of the movies contains <span style="color:#f77062">female</span> lead or <span style="color:#92bcea">minority</span> lead actor/actress. </p>
				<p>Hover over <span style="color:#f77062">movie titles</span> on the next pages to find out dots' location on the graph. </p>
				<p>Hover over <span style="color:#92bcea">dots</span> on the next pages to highlight the movie title on the left. </br> </br> <span style="font-size:8pt">*We only include titles for colored dots. </span></p>
			</div>
			<div class='step' data-step='5' id='step5'>
				<p>From <span style="color:#f77062">1960</span> to <span style="color:#f77062">1969</span>, <span style="color:#f77062">1/2</span> of the movies contain<span style="color:#f77062"> female</span> lead actress. <span style="color:#92bcea">None</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress. Note that only 2 movies are in this bracket after filtering.</p>
			</div>
			<div class='step' data-step='6' id='step6'>
				<p>From <span style="color:#f77062">1970</span> to <span style="color:#f77062">1979</span>, <span style="color:#f77062">1/9</span> of the movies contain<span style="color:#f77062"> female</span> lead actress. <span style="color:#92bcea">None</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='7' id='step7'>
				<p>From <span style="color:#f77062">1980</span> to <span style="color:#f77062">1989</span>, <span style="color:#f77062">1/25</span> of the movies contain<span style="color:#f77062"> female</span> lead actress. <span style="color:#92bcea">3/25</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='8' id='step8'>
				<p>From <span style="color:#f77062">1990</span> to <span style="color:#f77062">1999</span>, <span style="color:#f77062">6/68</span> of the movies contain<span style="color:#f77062"> female</span> lead actress. <span style="color:#92bcea">3/68</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='9' id='step9'>
				<p>From <span style="color:#f77062">1999</span> to <span style="color:#f77062">2009</span>, <span style="color:#f77062">19/170</span> of the movies contain<span style="color:#f77062"> female</span> lead actress. <span style="color:#92bcea">14/170</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='10' id='step10'>
				<p>From <span style="color:#f77062">2009</span> to <span style="color:#f77062">2018</span>, <span style="color:#f77062">39/223</span> of the movies contain<span style="color:#f77062"> female</span> lead actress. <span style="color:#92bcea">20/223</span> of the movies contain <span style="color:#92bcea">minority</span> lead actor/actress.</p>
			</div>
			<div class='step' data-step='11' id='step11'>
				<p>Despite the emergence of film and television series heralded for their diversity, Darnell Hunt, sociologist and co-author of UCLA's 2018 Hollywood Diversity Report, maintains <span style="color:#f77062">little has changed </span> both in front of and behind the camera.</p>
			</div>
			<div class='step' data-step='12' id='step12'>
				<p>However, we do notice some trends from our data...</p>
			</div>
			<div class='step' data-step='13' id='step13'>
				<p>Out of the top 15 movies with the highest box office, only 3 of them contain a <span style="color:#f77062">female</span> lead - <span style="color:#f77062">Rogue One: A Star Wars Story (2016)</span>, <span style="color:#f77062">Beauty and the Beast (2017)</span>, and <span style="color:#f77062">Finding Dory (2016)</span>; and only 1 of them contains a <span style="color:#92bcea">minority lead</span> - <span style="color:#92bcea">Black Panther (2018)</span>. Note that they're all very recent, and it seems to suggest that people are paying attention to diversity problems in Hollywood. </p>
			</div>
			<div class='step' data-step='14' id='step14'>
				<p>However, this is not conclusive - one possible explanation is that recent movies tend to have higher box office, and movies in the past might use female/minority lead but they just did not make it to our list. For more comprehensive results, more data and further analysis is needed.</p>
			</div>
 		</div>
	</section>

	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src='https://unpkg.com/intersection-observer'></script>
	<script src='https://unpkg.com/scrollama'></script>
	<script src="https://d3js.org/d3-selection-multi.v0.4.min.js"></script>
	<script>
		// We used a d3 library called Scrollama for the basic scrollytelling style of our project. However since it's so integrated with our own code it's nearly impossible to store the library in a separate JS file
		var container = d3.select('#scroll');
		var graphic = container.select('.scroll__graphic');
		var chart = graphic.select('.chart');
		var text = container.select('.scroll__text');
		var step = text.selectAll('.step');
		// format the year
		var formatYear=d3.timeFormat("%Y");
		// stop appending the narratives twice
		var appended1 = false;
		var appended2 = false;
		var appended3 = false;
		var appended4 = false;
		var appended5 = false;
		var appended6 = false;
		var appended7 = false;

		// containers sizes
		var w = 1000, h = 900;
		var width = 1200, height = 900;

		// for phi0
		var t0 = Date.now();

		var svg = d3.select(".chart")
		.insert("svg")
		.attr("width", w)
		.attr("height", h)
		.attr("id", "canvas");

		svg.append("circle")
		.attr("r", 10)
		.attr("cx", w/2)
		.attr("cy", h/2)
		.attr("class", "sun");
		var div = d3.select("#planetarium");

		// initialize the scrollama - library
		var scroller = scrollama();

		// generic window resize listener event - library
		function handleResize() {

			// 1. update height of step elements
			var stepHeight = Math.floor(window.innerHeight);
			step.style('height', stepHeight + 'px');

			// 2. update width/height of graphic element
			var bodyWidth = d3.select('body').node().offsetWidth;

			graphic
				.style('width', bodyWidth + 'px')
				.style('height', window.innerHeight + 'px');

			var textWidth = text.node().offsetWidth;
			var chartWidth = graphic.node().offsetWidth - textWidth;

			chart
			.style('width', chartWidth + 'px')
			.style('height', Math.floor(window.innerHeight) + 'px');


			// 3. tell scrollama to update new element dimensions
			scroller.resize();
		}

		// scrollama event handlers - library with customized steps
		function handleStepEnter(response) {
			// response = { element, direction, index }

			// add color to current step only
			step.classed('is-active', function (d, i) {
				return i === response.index;
			})

			// originally for scrolling up and stop the animation, however do not have time to fully implement
			// if (response.direction == "up" && response.index < 2){

			// 	chart.selectAll("g.planet")
			// 	.each(function(d, i){

			// 		if ((+formatYear(d.time)) >= 1937 && (+formatYear(d.time)) < 1949){

			// 			d3.select(this).remove();
			// 		}
			// 	});
			// } else if (response.direction == "up" && response.index < 4){

			// 	chart.selectAll("g.planet")
			// 	.each(function(d, i){

			// 		if ((+formatYear(d.time)) >= 1959 && (+formatYear(d.time)) < 1969){

			// 			d3.select(this).remove();
			// 		}
			// 	});
			// } else if (response.direction == "up" && response.index < 5){

			// 	chart.selectAll("g.planet")
			// 	.each(function(d, i){

			// 		if ((+formatYear(d.time)) >= 1969 && (+formatYear(d.time)) < 1979){

			// 			d3.select(this).remove();
			// 		}
			// 	});
			// } else if (response.direction == "up" && response.index < 6){

			// 	chart.selectAll("g.planet")
			// 	.each(function(d, i){

			// 		if ((+formatYear(d.time)) >= 1979 && (+formatYear(d.time)) < 1989){

			// 			d3.select(this).remove();
			// 		}
			// 	});
			// } else if (response.direction == "up" && response.index < 7){

			// 	chart.selectAll("g.planet")
			// 	.each(function(d, i){

			// 		if ((+formatYear(d.time)) >= 1989 && (+formatYear(d.time)) < 1999){

			// 			d3.select(this).remove();
			// 		}
			// 	});
			// } else if (response.direction == "up" && response.index < 8){

			// 	chart.selectAll("g.planet")
			// 	.each(function(d, i){

			// 		if ((+formatYear(d.time)) >= 1999 && (+formatYear(d.time)) <= 2009){

			// 			d3.select(this).remove();
			// 		}
			// 	});
			// } else if (response.direction == "up" && response.index < 9){

			// 	chart.selectAll("g.planet")
			// 	.each(function(d, i){
			// 		if ((+formatYear(d.time)) >= 2009 && (+formatYear(d.time)) < 2019){

			// 			d3.select(this).remove();
			// 		}
			// 	});
			// }

			if (response.direction == "down" && response.index == 2 && appended1 == false){

				var c = 0;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) > 1937 && (+formatYear(d.time)) <= 1949){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
                        .style("opacity",0.3)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

				           	if (d.if_female === 1){

					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "c"+c)
					            .attr("class", "planet minority")
					            .style("fill", "#f77062");

					            d3.select("#step3").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#c" + c)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 15);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#c" + c)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {
				           	    c = c + 1;
				           	    var dd=c;
					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "d"+dd)
					            .attr("class", "planet minority")
					            .style("fill", "#fff");

					            d3.select("#step3").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#d" + dd)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 15);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#d" + dd)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });
					        }

			        	}

			        }

				});

				appended1 = true;

			}

			else if (response.direction == "down" && response.index == 4 && appended2 == false){

				var e = 0;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) > 1959 && (+formatYear(d.time)) <= 1969){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
                        .style("opacity",0.3)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

			            	e = e + 1;

				           	if (d.if_female === 1){

					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "e"+e)
					            .attr("class", "planet minority")
					            .style("fill", "#f77062")
					            .on("mouseover", function (d) {
					            	d3.select("#step5").select("div")
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 1);
					            })
					            .on("mouseout", function(d) {
					            	d3.select("#step5").select("div")
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 0.3)
					            });

					            d3.select("#step5").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#e" + e)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 15);
						    	})
							    .on("mouseout", function(d){
							    	console.log("here2");
							    	console.log(e);
							    	d3.select("#e" + e)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {

					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("id", "e"+e)
					            .attr("cy", 0)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea");

					            d3.select("#step5").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#e" + e)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 15);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#e" + e)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });
					        }

			        	}

					}

				});

				appended2 = true;
			}

			else if (response.direction == "down" && response.index == 5 && appended3 == false){

				var f = 0;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) > 1969 && (+formatYear(d.time)) <= 1979){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
                        .style("opacity",0.3)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

			            	f = f + 1;

				           	if (d.if_female === 1){

					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "f"+f)
					            .attr("class", "planet minority")
					            .style("fill", "#f77062")
					            .on("mouseover", function (d) {
					            	d3.select("#step6").select("div")
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 1);
					            })
					            .on("mouseout", function(d) {
					            	d3.select("#step6").select("div")
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 0.3);
					            });

					            d3.select("#step6").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#f" + f)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 15);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#f" + f)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {

					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "f"+f)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea");

					            d3.select("#step6").append("div")
					            .html(d.title + "<br/>")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#f" + f)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 15);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#f" + f)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });
					        }

			        	}

			    	}

				});

				appended3 = true;
			}

			else if (response.direction == "down" && response.index == 6 && appended4 == false){

			    var g = 0;
				var h = g + 1;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) > 1979 && (+formatYear(d.time)) <= 1989){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
                        .style("opacity",0.3)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

				           	if (d.if_female === 1){

				           		g = g + 1;

					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "g"+g)
					            .attr("class", "planet minority")
					            .style("fill", "#f77062")
					            .on("mouseover", function (d) {
					            	d3.select("#step7").select("#title"+g)
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 1);
					            })
					            .on("mouseout", function(d) {
					            	d3.select("#step7").select("#title"+g)
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 0.3)
					            });


					            d3.select("#step7").append("div")
					            .html(d.title + " ")
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .attr("id", "title"+g)
					            .on("mouseover", function(d){
							    	d3.select("#g" + g)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 15);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#g" + g)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {

								h = h + 1;

								var o = h;
					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("id", "o"+o)
					            .attr("cy", 0)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea")
					            .on("mouseover", function (d) {
					            	d3.select("#step7").select("#title"+o)
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 1);
					            })
					            .on("mouseout", function(d) {
					            	d3.select("#step7").select("#title"+o)
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 0.3)
					            });


					            d3.select("#step7").append("div")
					            .html(d.title + " ")
					            .style("color", "grey")
					            .attr("id", "title"+o)
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#o" + o)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 15);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#o" + o)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });
					        }

			        	}

			    	}

				});

				appended4 = true;

			}

			else if (response.direction == "down" && response.index == 7 && appended5 == false){

			    var j = 0;
				var k = 0;
				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) >= 1989 && (+formatYear(d.time)) < 1999){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
                        .style("opacity",0.3)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

				           	if (d.if_female === 1){

				           		j = j + 1;

				           		var p = j;

					           	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("cy", 0)
					            .attr("id", "p" + p)
					            .attr("class", "planet minority")
					            .style("fill", "#f77062")
					            .on("mouseover", function (d) {
					            	d3.select("#step8").select("#title"+p)
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 1);
					            })
					            .on("mouseout", function(d) {
					            	d3.select("#step8").select("#title"+p)
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 0.3)
					            });

					            d3.select("#step8").append("div")
					            .html(d.title + " ")
					            .attr("id", "title"+ p)
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#p" + p)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 15);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#p" + p)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });

					        } else if (d.if_black === 1) {

					        	k = k + 1;

								var q = k;

					        	d3.select(this)
					            .append("circle")
					            .attr("r", d.r)
					            .attr("cx", d.R)
					            .attr("id", "q"+ q)
					            .attr("cy", 0)
					            .attr("class", "planet minority")
					            .style("fill", "#92bcea")
					            .on("mouseover", function (d) {
					            	d3.select("#step8").select("#title"+q)
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 1);
					            })
					            .on("mouseout", function(d) {
					            	d3.select("#step8").select("#title"+q)
					            	.transition()
					            	.duration(500)
					            	.style("color", "#fff")
					            	.style("opacity", 0.3)
					            });

					            d3.select("#step8").append("div")
					            .html(d.title + " ")
					            .attr("id", "title" + q)
					            .style("color", "grey")
					            .style("font-family", "Courier")
					            .on("mouseover", function(d){
							    	d3.select("#q" + q)
							    	.transition()
							    	.attr("fill", "#92bcea")
							    	.duration(500)
							    	.attr("r", 15);
						    	})
							    .on("mouseout", function(d){
							    	d3.select("#q" + q)
							    	.transition()
							    	.duration(500)
							    	.attr("r", 5);
							    });
					        }
					    }
			    	}

				});

				appended5 = true;

			}

			else if (response.direction == "down" && response.index == 8 && appended6 == false){

			    var l = 0;
				var m = 0;
				var minorityCounter = 0;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) >= 1999 && (+formatYear(d.time)) < 2009){
			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
                        .style("opacity",0.3)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

			            	minorityCounter = minorityCounter + 1;

			            	if (minorityCounter < 11 || minorityCounter > 23){

					           	if (d.if_female === 1){

									l = l + 1;

									var r = l;

						           	d3.select(this)
						            .append("circle")
						            .attr("r", d.r)
						            .attr("cx", d.R)
						            .attr("cy", 0)
									.attr("id","l" + r)
						            .attr("class", "planet minority")
						            .style("fill", "#f77062")
						            .on("mouseover", function (d) {
						            	d3.select("#step9").select("#title" + r)
						            	.transition()
						            	.duration(500)
						            	.style("color", "#fff")
						            	.style("opacity", 1);
						            })
						            .on("mouseout", function(d) {
						            	d3.select("#step9").select("#title" + r)
						            	.transition()
						            	.duration(500)
						            	.style("color", "#fff")
						            	.style("opacity", 0.3)
						            });

						           	d3.select("#step9").append("div")
						            .html(d.title + " ")
						            .attr("id", "title" + r)
						            .style("color", "grey")
						            .style("font-family", "Courier")
						            .on("mouseover", function(d){
								    	d3.select("#l" + r)
								    	.transition()
								    	.attr("fill", "#92bcea")
								    	.duration(500)
								    	.attr("r", 15);
							    	})
								    .on("mouseout", function(d){
								    	d3.select("#l" + r)
								    	.transition()
								    	.duration(500)
								    	.attr("r", 5);
								    });

						        } else if (d.if_black === 1) {

					           	    m = m + 1;

					           	    var s = m;

						        	d3.select(this)
						            .append("circle")
						            .attr("r", d.r)
						            .attr("cx", d.R)
						            .attr("cy", 0)
									.attr("id","m" + s)
						            .attr("class", "planet minority")
						            .style("fill", "#92bcea")
						            .on("mouseover", function (d) {
						            	d3.select("#step9").select("#title" + s)
						            	.transition()
						            	.duration(500)
						            	.style("color", "#fff")
						            	.style("opacity", 1);
						            })
						            .on("mouseout", function(d) {
						            	d3.select("#step9").select("#title" + s)
						            	.transition()
						            	.duration(500)
						            	.style("color", "#fff")
						            	.style("opacity", 0.3)
						            });

						        	d3.select("#step9").append("div")
						            .html(d.title + " ")
						            .attr("id", "title" + s)
						            .style("color", "grey")
						            .style("font-family", "Courier")
						            .on("mouseover", function(d){
								    	d3.select("#m" + s)
								    	.transition()
								    	.attr("fill", "#92bcea")
								    	.duration(500)
								    	.attr("r", 15);
							    	})
								    .on("mouseout", function(d){
								    	d3.select("#m" + s)
								    	.transition()
								    	.duration(500)
								    	.attr("r", 5);
								    });
								} else if (minorityCounter > 15 && minorityCounter < 21){
									d3.select("#step9").append("div")
									.style("font-size", 10+"px")
									.style("color", "white")
									.style("opacity", 0.5)
									.html("o" + "<br/>");
								}
					        }
			        	}
					}
				});

				appended6 = true;
			}

			else if (response.direction == "down" && response.index == 9 && appended7 == false){

			    var n = 0;
				var oo = 0;
				var minorityCounter = 0;

				chart.selectAll("g.planet")
				.each(function(d, i) {

					if ((+formatYear(d.time)) >= 2009 && (+formatYear(d.time)) < 2019){

			            d3.select(this)
			            .append("circle")
			            .attr("r", d.r)
			            .attr("cx", d.R)
			            .attr("cy", 0)
                        .style("opacity",0.3)
			            .attr("class", "planet");

			            if (d.if_female === 1 || d.if_black === 1) {

			            	minorityCounter = minorityCounter + 1;

			            	if (minorityCounter < 11 || minorityCounter > 49){

					           	if (d.if_female === 1){

									n = n + 1;

									var t = n;

						           	d3.select(this)
						            .append("circle")
						            .attr("r", d.r)
						            .attr("cx", d.R)
						            .attr("cy", 0)
									.attr("id","n" + t)
						            .attr("class", "planet minority")
						            .style("fill", "#f77062")
						            .on("mouseover", function (d) {
						            	d3.select("#step10").select("#title" + t)
						            	.transition()
						            	.duration(500)
						            	.style("color", "#fff")
						            	.style("opacity", 1);
						            })
						            .on("mouseout", function(d) {
						            	d3.select("#step10").select("#title" + t)
						            	.transition()
						            	.duration(500)
						            	.style("color", "#fff")
						            	.style("opacity", 0.3)
						            });

						           	d3.select("#step10").append("div")
						            .html(d.title + " ")
						            .attr("id", "title" + t)
						            .style("color", "grey")
						            .style("font-family", "Courier")
						            .on("mouseover", function(d){
								    	d3.select("#n" + t)
								    	.transition()
								    	.attr("fill", "#92bcea")
								    	.duration(500)
								    	.attr("r", 15);
							    	})
								    .on("mouseout", function(d){
								    	d3.select("#n" + t)
								    	.transition()
								    	.duration(500)
								    	.attr("r", 5);
								    });

						        } else if (d.if_black === 1) {

									oo = oo + 1;

									var u = oo;

						        	d3.select(this)
						            .append("circle")
						            .attr("r", d.r)
						            .attr("cx", d.R)
						            .attr("cy", 0)
									.attr("id","oo" + u)
						            .attr("class", "planet minority")
						            .style("fill", "#92bcea")
						            .on("mouseover", function (d) {
						            	d3.select("#step10").select("#title" + u)
						            	.transition()
						            	.duration(500)
						            	.style("color", "#fff")
						            	.style("opacity", 1);
						            })
						            .on("mouseout", function(d) {
						            	d3.select("#step10").select("#title" + u)
						            	.transition()
						            	.duration(500)
						            	.style("color", "#fff")
						            	.style("opacity", 0.3)
						            });

						        	d3.select("#step10").append("div")
						            .html(d.title + " ")
						            .attr("id", "title" + u)
						            .style("color", "grey")
						            .style("font-family", "Courier")
						            .on("mouseover", function(d){
								    	d3.select("#oo" + u)
								    	.transition()
								    	.attr("fill", "#92bcea")
								    	.duration(500)
								    	.attr("r", 15);
							    	})
								    .on("mouseout", function(d){
								    	d3.select("#oo" + u)
								    	.transition()
								    	.duration(500)
								    	.attr("r", 5);
								    });

						        }
						    } else if (minorityCounter > 15 && minorityCounter < 19){
						    	d3.select("#step10").append("div")
						    	.style("font-size", 10+"px")
						    	.style("color", "white")
						    	.style("opacity", 0.5)
						    	.html("&#9679;<br/>");
						    }
			        	}

					}

				});

				appended7 = true;
			}

			// zoom in and highlight animation

			else if (response.direction == "down" && response.index == 12){

			    d3.selectAll("g.planet")
				.each(function(d) {
					d.speed = 0;
                });

				d3.selectAll("g.planet").selectAll("circle")
				.filter(function(d){return (d.title!=="Black Panther") || (d.title!=="Rogue One: A Star Wars Story") || (d.title!=="Beauty and the Beast&y=2017") || (d.title!=="Finding Dory") })
				.transition()
				.duration(500)
				.style("opacity",0.1);

				d3.selectAll("g.planet").selectAll("circle")
				.filter(function(d){ return (d.title==="Black Panther") || (d.title==="Rogue One: A Star Wars Story") || (d.title==="Beauty and the Beast&y=2017") || (d.title==="Finding Dory") })
				.transition()
				.duration(500)
				.attr("r",10);

//				 var zoom, zoomable_layer;
//				 var amp = 1;
//				 zoomable_layer = svg;
//				 zoom = d3.zoom().scaleExtent([1, 10]).on('zoom', function() {
//
//				 	return zoomable_layer.attrs({
//				 		transform: d3.event.transform
//				 	});
//				 });
//
//				 svg.call(zoom);
//				 to_bounding_box = function(W, H, center) {
//				 	var x, y;
//				 	x = W / 2 - center.x*amp;
//				 	y = H / 2 - center.y*amp;
//				 	return d3.zoomIdentity.translate(x,y).scale(amp);
//				 };
//				 var center, transform;
//				 center = {
//				 	x: d3.select("#m1").node().getBoundingClientRect().x,
//				 	y: d3.select("#m1").node().getBoundingClientRect().y
//				 };
//
//				 transform = to_bounding_box(width, height, center);
//				 svg.transition().duration(2000).call(zoom.transform, transform);

			}

		}

		// library
		function handleContainerEnter(response) {
			// response = { direction }

			// sticky the graphic (old school)
			graphic.classed('is-fixed', true);
			graphic.classed('is-bottom', false);
		}

		// library
		function handleContainerExit(response) {
			// response = { direction }

			// un-sticky the graphic, and pin to top/bottom of container
			graphic.classed('is-fixed', false);
			graphic.classed('is-bottom', response.direction === 'down');
		}

		// library init function
		function init() {
			// 1. force a resize on load to ensure proper dimensions are sent to scrollama
			handleResize();

			// 2. setup the scroller passing options
			// this will also initialize trigger observations
			// 3. bind scrollama event handlers (this can be chained like below)
			scroller.setup({
				container: '#scroll',
				graphic: '.scroll__graphic',
				text: '.scroll__text',
				step: '.scroll__text .step',
			})
				.onStepEnter(handleStepEnter)
				.onContainerEnter(handleContainerEnter)
				.onContainerExit(handleContainerExit);

			// setup resize event
			window.addEventListener('resize', handleResize);

		    var container = svg.append("g")
		    .attr("class","spinner")
		    .attr("transform", "translate(" + w/2 + "," + h/2 + ")");

		    // time formatting
		    var parseTime = d3.timeParse("%d-%b-%Y");

		    // orbit scales
 			var inter1=d3.scaleTime().domain([parseTime("01-Jan-1937"),parseTime("31-Dec-1949")]).range([50, 80]);
      		var inter2=d3.scaleTime().domain([parseTime("01-Jan-1950"),parseTime("31-Dec-1959")]).range([100, 130]);
      		var inter3=d3.scaleTime().domain([parseTime("01-Jan-1960"),parseTime("31-Dec-1969")]).range([150, 180]);
      		var inter4=d3.scaleTime().domain([parseTime("01-Jan-1970"),parseTime("31-Dec-1979")]).range([200, 230]);
    		var inter5=d3.scaleTime().domain([parseTime("01-Jan-1980"),parseTime("31-Dec-1989")]).range([250, 280]);
      		var inter6=d3.scaleTime().domain([parseTime("01-Jan-1990"),parseTime("31-Dec-1999")]).range([300, 330]);
      		var inter7=d3.scaleTime().domain([parseTime("01-Jan-2000"),parseTime("31-Dec-2009")]).range([350, 380]);
      		var inter8=d3.scaleTime().domain([parseTime("01-Jan-2010"),parseTime("01-May-2018")]).range([400, 430]);

      		// speed based on box office
		    var speedScale=d3.scaleLinear().domain([120908074,1000000000]).range([5,1]);

		    var divisionOrbitData=[90,140,190,240,290,340,390];
      		svg.selectAll(".division")
            .data(divisionOrbitData)
          	.enter()
          	.append("circle")
          	.attr("class","division")
         	.each(function(d){
             	d3.select(this)
                .attr("cx", w/2)
                .attr("cy", h/2)
                .attr("r", d)
                .style("fill","none")
                .style("stroke","#fff");
          	});

         	// data processing
		    function parseline(line){

		        var year=+formatYear(parseTime(line.year));

		        if(year<=1949){
		            var radiusOrbit=inter1(parseTime(line.year));
		        }
		        else if(year<=1959){
		            radiusOrbit=inter2(parseTime(line.year));
		        }
		        else if(year<=1969){
		            radiusOrbit=inter3(parseTime(line.year));
		        }
		        else if(year<=1979){
		            radiusOrbit=inter4(parseTime(line.year));
		        }
		        else if(year<=1989){
		            radiusOrbit=inter5(parseTime(line.year));
		        }
		        else if(year<=1999){
		            radiusOrbit=inter6(parseTime(line.year));
		        }
		        else if(year<=2009){
		            radiusOrbit=inter7(parseTime(line.year));
		        }
		        else if(year<=2018){
		            radiusOrbit=inter8(parseTime(line.year));
		        }
		        return {
		        	title:line.title,
		            time:parseTime(line.year),
		            box_office:+line.box_office,
		            if_female:+line.female_lead,
		            if_black:+line.non_white_lead,
		            radiusOrbit:radiusOrbit,
		            radiusDot:5,
		            speed:speedScale(line.box_office),
		            phi0: Math.floor(360*Math.random())
        		}
		    }

		    // read in csv
		    d3.csv("./movie_actor.csv",parseline,function(data) {

		        var planets = [];
		        data.forEach(function (d) {
		            planets.push({
		            	title:d.title,
		            	time: d.time,
		                R: d.radiusOrbit,
		                r: d.radiusDot,
		                speed: d.speed,
		                temp: d.speed,
		                phi0: d.phi0,
		                if_female: d.if_female,
		                if_black: d.if_black
		            });
		        });

		        container.selectAll("g.planet")
		        .data(planets)
		        .enter()
		        .append("g")
		        .attr("class", "planet")
		        .each(function (d, i) {

		            d3.select(this)
		            .append("circle")
		            .attr("class", "orbit")
		            .attr("r", d.R)
		            .style("stroke", "none");

		        });

		        var j = 0;

		        // start and stop the spinning based on click
		        d3.select("svg#canvas")
		        .on("click", function(){
		        	if (j % 2 === 0){
		        		j = j + 1;
		        		container.selectAll("g.planet")
		        		.data(planets)
		        		.each(function(d){
		        			d.speed = 0;
		        		});
		        	}else {
		        		j = j + 1;
		        		container.selectAll("g.planet")
		        		.data(planets)
		        		.each(function(d){
		        			d.speed = d.temp;
		        		});
		        	}
		        });

		        // legends
		        d3.select("#canvas")
			    .append("circle")
				.attr("r", 5)
				.attr("cx", 800)
				.attr("cy", 50)
				.style("fill", "#f77062");

				d3.select("#canvas")
				.append("text")
				.text("female lead")
				.attr("x", 810)
				.attr("y", 55)
				.style("font-family", "Courier")
				.style("fill", "white");

				d3.select("#canvas")
			    .append("circle")
				.attr("r", 5)
				.attr("cx", 800)
				.attr("cy", 70)
				.style("fill", "#92bcea");

				d3.select("#canvas")
				.append("text")
				.text("minority lead")
				.attr("x", 811)
				.attr("y", 75)
				.style("font-family", "Courier")
				.style("fill", "white");

				d3.select("#canvas")
			    .append("circle")
				.attr("r", 5)
				.attr("cx", 800)
				.attr("cy", 90)
				.style("fill", "white");

				d3.select("#canvas")
				.append("text")
				.text("male/Caucasian")
				.attr("x", 810)
				.attr("y", 95)
				.style("font-family", "Courier")
				.style("fill", "white");

				d3.select("#canvas")
				.append("text")
				.text("lead")
				.attr("x", 810)
				.attr("y", 115)
				.style("font-family", "Courier")
				.style("fill", "white");

		        d3.timer(function () {

		            var delta = (Date.now() - t0);

		            svg.selectAll(".planet")
		            .attr("transform", function (d) {
		                return "rotate(" + d.phi0 + delta * d.speed / 500 + ")";
		            });

		        });

		    });

		}

		// kick things off
		init();

	</script>
</body>

</html>